{#
articles (tableau de dictionnaires)
* tableau de "article"
    * id_article, nom, type_article_id, prix
    * option :
        * stock ,
        * nb_avis ,
        * nb_declinaisons
#}
{% extends 'client/layout_client.html' %}

{% block title %}
    <title>Liste d'envies</title>
{% endblock %}

{% block body %}
<div class="w-full">
    <div class="bg-dark-secondary rounded-lg p-4 mb-3 shadow-lg">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-white">Votre liste d'envies</h2>
            <span class="text-accent-blue font-medium">
                {{ nb_articles_envies }} article{% if nb_articles_envies > 1 %}s{% endif %}
            </span>
        </div>
        
        {% if id_article_selected %}
            {% if nb_autres_clients > 0 %}
                <p style="color: green">{{ nb_autres_clients }} client(s) autre(s) que vous ont ajout√© cet article dans leur wishlist</p>
            {% else %}
                <p style="color: green">Vous √™tes le seul √† avoir cet article dans votre wishlist</p>
            {% endif %}
            
            {% if nb_articles_meme_type > 0 %}
                <p style="color: blue">Vous avez {{ nb_articles_meme_type }} autre(s) article(s) du m√™me type dans votre wishlist</p>
            {% endif %}
        {% endif %}
        
        {% if articles_liste_envies | length >= 1 %}
        <div class="space-y-4">
            {% for ligne in articles_liste_envies %}
            <div class="bg-dark-secondary rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300">
                <div class="flex flex-col md:flex-row">
                    <div class="relative w-full md:w-64 h-48">
                        <a href="{{ url_for('client_liste_envies.client_liste_envies_show', id_article=ligne.id_skin) }}">
                            {% if ligne.image is not none %}
                            <img src="{{ url_for('static', filename='images/' + ligne.image) }}" 
                                 class="w-full h-full object-cover" 
                                 alt="image de {{ ligne.nom }}">
                            {% else %}
                            <img src="{{ url_for('static', filename='images/no_photo.jpeg') }}" 
                                 class="w-full h-full object-cover" 
                                 alt="pas d'image">
                            {% endif %}
                        </a>
                        <div class="absolute top-2 right-2 flex flex-col space-y-2">
                            <span class="bg-dark-primary bg-opacity-90 text-gray-300 px-2 py-1 rounded text-sm font-medium">
                                {{ ligne.type_skin }}
                            </span>
                            {% if ligne.special != 'Normal' %}
                            <span class="bg-dark-primary bg-opacity-90 text-yellow-400 px-2 py-1 rounded text-sm font-medium">
                                {{ ligne.special }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex-grow p-4 flex flex-col md:flex-row md:justify-between md:items-center">
                        <div class="flex-grow">
                            <h3 class="text-lg font-semibold text-white">{{ ligne.nom }}</h3>
                            <div class="mt-1 mb-3">
                                <span class="inline-block bg-dark-accent text-accent-blue px-2 py-1 rounded text-xs font-medium">
                                    {{ ligne.usure }}
                                </span>
                            </div>
                            <div class="flex items-center gap-4 mb-4 md:mb-0">
                                <div class="text-accent-blue font-bold text-xl">
                                    {% if ligne.prix_min == ligne.prix_max %}
                                        {{ "{:,.2f}".format(ligne.prix_min) }}‚Ç¨
                                    {% else %}
                                        {{ "{:,.2f}".format(ligne.prix_min) }}‚Ç¨ - {{ "{:,.2f}".format(ligne.prix_max) }}‚Ç¨
                                    {% endif %}
                                </div>
                                <div class="flex items-center">
                                    {% if ligne.stock_total > 0 %}
                                    <span class="text-gray-400 text-sm">Stock total: {{ ligne.stock_total }}</span>
                                    {% else %}
                                    <span class="text-red-500 text-sm">Rupture de stock</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <form action="/client/envie/commander" method="post">
                                <input type="hidden" name="id_article" value="{{ ligne.id_skin }}">
                                <input type="hidden" name="quantite" value="1">
                                <button class="bg-accent-blue hover:bg-blue-600 text-white font-medium py-2 px-4 rounded transition-colors duration-200"
                                        {% if ligne.stock_total <= 0 %}disabled class="bg-gray-600 cursor-not-allowed text-gray-300 font-medium py-2 px-4 rounded"{% endif %}>
                                    {% if ligne.stock_total > 0 %}
                                        Ajouter au panier
                                    {% else %}
                                        Indisponible
                                    {% endif %}
                                </button>
                            </form>
                            <a href="/client/envie/delete?id_article={{ ligne.id_skin }}" 
                               class="inline-flex items-center justify-center bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded transition-colors duration-200">
                                <span>üóëÔ∏è</span>
                            </a>
                            <div class="flex gap-1">
                                <!-- Bouton Premier -->
                                {% if not loop.first %}
                                <a href="/client/envies/first?id_article={{ ligne.id_skin }}" 
                                   class="inline-flex items-center justify-center bg-dark-accent hover:bg-dark-accent/80 text-white font-medium py-2 px-4 rounded transition-colors duration-200">
                                    <span>‚§í</span>
                                </a>
                                {% endif %}
                                
                                <!-- Bouton Monter -->
                                {% if not loop.first %}
                                <a href="/client/envies/up?id_article={{ ligne.id_skin }}" 
                                   class="inline-flex items-center justify-center bg-dark-accent hover:bg-dark-accent/80 text-white font-medium py-2 px-4 rounded transition-colors duration-200">
                                    <span>‚¨ÜÔ∏è</span>
                                </a>
                                {% endif %}
                                
                                <!-- Bouton Descendre -->
                                {% if not loop.last %}
                                <a href="/client/envies/down?id_article={{ ligne.id_skin }}" 
                                   class="inline-flex items-center justify-center bg-dark-accent hover:bg-dark-accent/80 text-white font-medium py-2 px-4 rounded transition-colors duration-200">
                                    <span>‚¨áÔ∏è</span>
                                </a>
                                {% endif %}
                                
                                <!-- Bouton Dernier -->
                                {% if not loop.last %}
                                <a href="/client/envies/last?id_article={{ ligne.id_skin }}" 
                                   class="inline-flex items-center justify-center bg-dark-accent hover:bg-dark-accent/80 text-white font-medium py-2 px-4 rounded transition-colors duration-200">
                                    <span>‚§ì</span>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="bg-dark-secondary rounded-lg overflow-hidden shadow-lg">
            <div class="p-4">
                <h3 class="text-lg font-semibold text-white">Aucun article dans votre liste d'envies</h3>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Historique Section -->
    <div class="bg-dark-secondary rounded-lg p-4 mt-8 shadow-lg">
        <h2 class="text-2xl font-bold text-white mb-4">Derniers articles consult√©s</h2>
        <div class="space-y-4">
            {% for article in articles_historique %}
            <div class="bg-dark-secondary rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300">
                <div class="flex flex-col md:flex-row">
                    <div class="relative w-full md:w-64 h-48">
                        <a href="{{ url_for('client_liste_envies.client_liste_envies_show', id_article=article.id_skin) }}">
                            {% if article.image is not none %}
                            <img src="{{ url_for('static', filename='images/' + article.image) }}" 
                                 class="w-full h-full object-cover" 
                                 alt="image de {{ article.nom }}">
                            {% else %}
                            <img src="{{ url_for('static', filename='images/no_photo.jpeg') }}" 
                                 class="w-full h-full object-cover" 
                                 alt="pas d'image">
                            {% endif %}
                        </a>
                        <div class="absolute top-2 right-2 flex flex-col space-y-2">
                            <span class="bg-dark-primary bg-opacity-90 text-gray-300 px-2 py-1 rounded text-sm font-medium">
                                {{ article.type_skin }}
                            </span>
                            {% if article.special != 'Normal' %}
                            <span class="bg-dark-primary bg-opacity-90 text-yellow-400 px-2 py-1 rounded text-sm font-medium">
                                {{ article.special }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex-grow p-4 flex flex-col md:flex-row md:justify-between md:items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-white">{{ article.nom }}</h3>
                            <div class="mt-1 mb-3">
                                <span class="inline-block bg-dark-accent text-accent-blue px-2 py-1 rounded text-xs font-medium">
                                    {{ article.usure }}
                                </span>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="text-accent-blue font-bold text-xl">
                                    {% if article.prix_min == article.prix_max %}
                                        {{ "{:,.2f}".format(article.prix_min) }}‚Ç¨
                                    {% else %}
                                        {{ "{:,.2f}".format(article.prix_min) }}‚Ç¨ - {{ "{:,.2f}".format(article.prix_max) }}‚Ç¨
                                    {% endif %}
                                </div>
                                <div class="flex items-center">
                                    {% if article.stock_total > 0 %}
                                    <span class="text-gray-400 text-sm">Stock total: {{ article.stock_total }}</span>
                                    {% else %}
                                    <span class="text-red-500 text-sm">Rupture de stock</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
