{#
articles (tableau de dictionnaires)
* tableau de "article"
    * id_article, nom, type_article_id, prix
    * option :
        * stock ,
        * nb_avis ,
        * nb_declinaisons
#}
{% extends 'admin/layout_admin.html' %}

{% block title %}
    <title>Gestion des Articles</title>
{% endblock %}

{% block body %}
<div class="container mx-auto px-2 py-8">
    <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-gray-200">Gestion des articles et du stock</h3>
        <a href="/admin/article/add" class="rounded-md bg-green-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500">
            <i class="fas fa-plus"></i> Ajouter un article
        </a>
    </div>

    <div class="bg-gray-800 shadow-sm ring-1 ring-gray-700 sm:rounded-lg">
        <div class="overflow-x-visible">
            <table class="w-full table-fixed divide-y divide-gray-700">
                <thead>
                    <tr>
                        <th class="w-1/6 py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-200">Nom</th>
                        <th class="w-[5%] px-3 py-3.5 text-left text-sm font-semibold text-gray-200">ID</th>
                        <th class="w-[10%] px-3 py-3.5 text-left text-sm font-semibold text-gray-200">Type</th>
                        <th class="w-[8%] px-3 py-3.5 text-left text-sm font-semibold text-gray-200">Prix</th>
                        <th class="w-[8%] px-3 py-3.5 text-left text-sm font-semibold text-gray-200">Stock</th>
                        <th class="w-[12%] px-3 py-3.5 text-left text-sm font-semibold text-gray-200">Avis</th>
                        <th class="w-[8%] px-3 py-3.5 text-left text-sm font-semibold text-gray-200">Décl.</th>
                        <th class="w-[12%] px-3 py-3.5 text-center text-sm font-semibold text-gray-200">Image</th>
                        <th class="w-[20%] px-3 py-3.5 text-center text-sm font-semibold text-gray-200">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                    {% if articles | length >= 1 %}
                        {% for ligne in articles %}
                            <tr class="hover:bg-gray-700">
                                <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm text-gray-200 sm:pl-6">{{ ligne.nom }}</td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-300">{{ ligne.id_article }}</td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm">
                                    <span class="text-red-400">{{ ligne.libelle }}</span>
                                    <span class="text-gray-300">({{ ligne.type_article_id }})</span>
                                </td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-300">{{  "{:,.2f} €".format(ligne.prix) }}</td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm">
                                    {% if ligne.stock is defined %}
                                        {% if ligne.stock != None %}
                                            {% if ligne.stock > 0 %}
                                                <span class="text-green-400 font-semibold">{{ ligne.stock }}</span>
                                                {% if ligne.min_stock is defined and ligne.min_stock <= 0 %}
                                                    <span class="text-amber-400">(⚠️ déclinaison(s) en rupture)</span>
                                                {% endif %}
                                            {% else %}
                                                <span class="text-gray-400">article momentanément indisponible</span>
                                            {% endif %}
                                        {% else %}
                                            <span class="text-gray-400">déclinaison ND</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-gray-400">ND</span>
                                    {% endif %}
                                </td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm">
                                    {% if ligne.nb_commentaires_nouveaux is defined %}
                                        {% if ligne.nb_commentaires_nouveaux > 0 %}
                                            <a href="/admin/article/commentaires?id_article={{ ligne.id_article }}" class="text-red-400 font-semibold">
                                                {{ ligne.nb_commentaires_nouveaux }} avis non lu(s) ⚠️
                                            </a>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-gray-400">nb_avis ND</span>
                                    {% endif %}
                                </td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-300">
                                    {% if ligne.nb_declinaisons is defined %}
                                        {{ ligne.nb_declinaisons }}
                                    {% else %}
                                        <span class="text-gray-400">decli ND</span>
                                    {% endif %}
                                </td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm">
                                    {% if ligne.image is not none %}
                                        <img class="h-16 w-16 rounded-full object-cover" src="{{ url_for('static', filename='images/' + ligne.image) }}" alt="image de {{ ligne.nom }}">
                                    {% else %}
                                        <img class="h-16 w-16 rounded-full object-cover" src="{{ url_for('static', filename='images/no_photo.jpeg') }}" alt="pas d'image">
                                    {% endif %}
                                </td>
                                <td class="whitespace-nowrap px-3 py-4 text-sm text-center">
                                    <div class="flex flex-col space-y-2">
                                        <a href="/admin/article/delete?id_article={{ ligne.id_article }}" 
                                           onclick="return confirm('Êtes-vous sûr ?')"
                                           class="rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500">
                                            Supprimer
                                        </a>
                                        <a href="/admin/article/edit?id_article={{ ligne.id_article }}"
                                           class="rounded-md bg-yellow-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-yellow-500">
                                            Éditer
                                        </a>
                                        <button
                                           class="rounded-md bg-gray-500 px-3 py-2 text-sm font-semibold text-gray-300 cursor-not-allowed opacity-50"
                                           disabled
                                           title="Fonctionnalité à venir">
                                            Commentaires (Bientôt)
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="9" class="px-3 py-4 text-sm text-gray-300 text-center">
                                Aucun article disponible
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
